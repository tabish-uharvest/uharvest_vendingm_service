version: "3.8"

services:
  api:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: vending-api

    extra_hosts:
      - "host.docker.internal:host-gateway"

    environment:
      DATABASE_URL: "postgresql+asyncpg://uharvest:Tabish@host.docker.internal:5433/uharvest_db"
      DATABASE_URL_SYNC: "postgresql://uharvest:Tabish@host.docker.internal:5433/uharvest_db"

      HOST: "0.0.0.0"
      PORT: "8000"
      DEBUG: "True"
      RELOAD: "False"

      SECRET_KEY: "your-secret-key-here-change-in-production"
      ALGORITHM: "HS256"
      ACCESS_TOKEN_EXPIRE_MINUTES: "30"

      ALLOWED_ORIGINS: '["http://localhost:5001"]'

      LOG_LEVEL: "INFO"
      LOG_FORMAT: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"

      DB_POOL_SIZE: "5"
      DB_MAX_OVERFLOW: "10"
      DB_POOL_TIMEOUT: "30"
      DB_POOL_RECYCLE: "3600"

      MULTI_MACHINE_MODE: "true"
      AUTO_REGISTER_MACHINE: "true"
      DEFAULT_CUPS_QTY: "100"
      DEFAULT_BOWLS_QTY: "50"

    ports:
      - "8000:8000"

    volumes:
      - ./vending_api:/app

    restart: unless-stopped
